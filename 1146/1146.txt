 Syst. Biol. 61(3):510–521, 2012
c TheAuthor(s)2012.PublishedbyOxfordUniversityPress,onbehalfoftheSocietyofSystematicBiologists.Allrightsreserved.
For Permissions, please email: journals.permissions@oup.com DOI:10.1093/sysbio/sys024
Advance Access publication on February 13, 2012
Accurate Estimation of Substitution Rates with Neighbor-Dependent Models in a Phylogenetic Context
JEAN BE ́RARD1AND LAURENT GUE ́GUEN2,∗
1Institut Camille Jordan, UMR CNRS 5208, Universite ́ Lyon 1, Villeurbanne F-69622 Cedex, Universite ́ de Lyon, Lyon 69003, France; and 2Laboratoire de Biome ́trie et Biologie E ́volutive, UMR CNRS 5558, Universite ́ Lyon 1, Villeurbanne F-69622 Cedex, Universite ́ de Lyon, Lyon 69003, France;
Correspondence to be sent to: Laboratoire de Biome ́trie et Biologie E ́volutive, UMR CNRS 5558, Universite ́ Claude Bernard Lyon I, 16, rue Raphae ̈l Dubois, 69622 Villeurbanne cedex, France; E-mail: Laurent.Gueguen@univ-lyon1.fr.
Received 22 June 2010; reviews returned 7 December 2010; accepted 26 January 2012 Associate Editor: Olivier Gascuel
Abstract.—Most models and algorithms developed to perform statistical inference from DNA data make the assumption that substitution processes affecting distinct nucleotide sites are stochastically independent. This assumption ensures both mathematical and computational tractability but is in disagreement with observed data in many situations—one wellknown example being CpG dinucleotide hypermutability in mammalian genomes. In this paper, we consider the class of RN95 + YpR substitution models, which allows neighbor-dependent effects—including CpG hypermutability—to be taken into account, through transitions between pyrimidine–purine dinucleotides. We show that it is possible to adapt inference methods originally developed under the assumption of independence between sites to RN95 + YpR models, using a mathematically rigorous framework provided by specific structural properties of this class of models. We assess how efficient this approach is at inferring the CpG hypermutability rate from aligned DNA sequences. The method is tested on simulated data and compared against several alternatives; the results suggest that it delivers a high degree of accuracy at a low computational cost. We then apply our method to an alignment of 10 DNA sequences from primate species. Model comparisons within the RN95 + YpR class show the importance of taking into account neighbor-dependent effects. An application of the method to the detection of hypomethylated islands is discussed. [CpG hypermutability; CpG islands; maximum likelihood phylogeny; neighbor-dependent substitution.]
Many stochastic models of nucleotide substitution have been developed since the early work of Jukes and Cantor (1969). They rely on increasingly elaborate Markov substitution processes as they incorporate more and more biological characteristics of actual nucleotide substitution processes (see Yang 1996; Lio ́ and Goldman 1998; Felsenstein 2004 for an overview of evolutionary models).
The most common models are based on a 4 × 4 rate matrix describing a neighbor-independent Markov nucleotide substitution process. Such a matrix comprises 12 substitution rates, and biological hypotheses are usually built into the model to somehow constrain the parameters and have it reflect some relevant biological features. These models are mathematically tractable and allow for the development of efficient algorithms for phylogenetic inference, using, for example, maximum likelihood or Bayesian methods. Early algorithms made use of the assumptions that the sequences were at equilibrium and evolved under a reversible substitution model. To accommodate for situations where these assumptions are not met, more general maximum likelihood algorithms were developed, which can handle nonreversible and nonstationary situations, and still are very efficient at performing inference, see Felsenstein (2004).
An important property shared by the models just described is neighbor independence: The matrix of substitution rates at a site is unaffected by the base composition at other sites in the sequence. As a consequence, the substitution processes affecting distinct sites in
the sequence are stochastically independent, and, for example, the long-term frequency of a dinucleotide xy has to be equal to the product of the long-term frequencies of x and y. Statistical analyses have shown that, for many genomes, this is not true (Burge et al. 1992; Karlin and Burge 1995), even in noncoding regions. In mammalian genomes, the most important neighbordependent effect comes from the hypermutability of CpG dinucleotides: Because of cytosine methylation, the substitution rate of a CpG dinucleotide into TpG or CpA is about 10 times higher than the overall substitution rateofaCintoaToraGintoanA(Bird1980;Nachman and Crowell 2000; Zhang et al. 2007). The problem of extending available inference tools to include models that take into account such neighbor-dependent substitution rates is thus biologically relevant.
The main difficulty with neighbor-dependent substitution rates lies in the propagation of dependencies from site to site. Technically speaking, models with neighbordependent substitution rates lead to arbitrarily longrange dependencies, even though these dependencies are most often expected to decay exponentially fast along the sequence. The complexity of such processes is usually impossible to handle exactly, and either approximations or simulation-based methods have to be used.
One approach is to approximate the complicated dependence structure induced by the model, by a simpler structure leading to tractable computations. A surrogate for the original likelihood of the model can thus be computed and exploited within a maximum likelihood or a
510
Downloaded from http://sysbio.oxfordjournals.org/ at MBLWHOILibrary on June 19, 2012

 2012 BE ́RARDANDGUE ́GUEN—RN95+YpRMODELSINAPHYLOGENETICCONTEXT 511
 Bayesian framework. Examples of this approach include using a Markov model representation of the nucleotide sequence (Duret and Galtier 2000; Arndt et al. 2003; Siepel and Haussler 2004) and working at the level of dior trinucleotides only (Sved and Bird 1990; Arndt and Hwa 2005; Christensen et al. 2005; Christensen 2006; Peifer et al. 2008); see also Lunter and Hein (2004). This approach in general leads to computationally efficient algorithms, but the reliability of the corresponding approximations is usually difficult to assess.
Another approach consists in using data augmentation techniques, applying the Monte Carlo Markov Chain (MCMC) methodology to sample from the conditional distribution of the (unobserved) substitution histories of sites, given the observed data, and then using either maximum likelihood (such as ExpectationMaximization) or Bayesian strategies. See Pedersen and Jensen (2001), Hwang and Green (2004), Baele et al. (2008), Duret and Arndt (2008), Hobolth (2008), and Baele et al. (2010a, 2010b). This approach faithfully reflects the dynamics specified by neighbor-dependent substitution rates but leads in general to computerintensive algorithms, for which convergence is an issue.
In this paper, we develop an original approach based on the use of the so-called RN95 + YpR neighbordependent substitution models. These models are obtained by combining a neighbor-independent RN95 model [named after Rzhetsky and Nei (1995), see also Schadt et al. (1998)] to a set of transition rates between pyrimidine–purine dinucleotides (denoted generically as YpR) that model neighbor-dependent effects. A theoretical study of their properties was made in Be ́rard et al. (2008). It turns out that, thanks to specific structural properties of RN95 + YpR models, we can adapt inference algorithms originally developed for site-independent models, without the need for approximating the dependence structure of the substitution model. The resulting algorithms combine a low computational cost with a mathematically rigorous treatment of the substitution model, despite the presence of neighbor-dependent effects.
We assess how efficient our method is at inferring the CpG hypermutability rate from aligned DNA sequences. Using a simulated data set intended to mimic an alignment of Human, Chimpanzee, and Macaque sequences, we compare the accuracy of the estimates produced by our method against several alternative approaches. The results suggest that our method is able to deliver accurate estimates even in rather unfavorable situations (short sequences, shallow phylogenetic tree with a small number of leaves, low fraction of CpG dinucleotides in the ancestral sequence). We then apply our method to an alignment of DNA sequences from 10 primate species. We perform model comparisons within the RN95 + YpR class. Finally, we compute estimates of the CpG hypermutability rate and explain how monitoring the variation of this rate along the sequence can be used to detect hypomethylated islands inside the human genome.
MATERIALS AND METHODS
RN95 + YpR Models
Definition of RN95 + YpR models.—A precise description of the RN95 + YpR nucleotide substitution model can be provided as follows. Such a model consists in the superposition of an RN95 model describing neighborindependent nucleotide substitution rates and of a YpR model describing additional neighbor-dependent transition rates.
The RN95 part of the model consists of a 4 × 4 rate matrix belonging to the RN95 class, named after Rzhetsky and Nei (1995) (see also Schadt et al. 1998 for a thorough study of this model). This means a matrix S=(sx,y)x,y∈A, where A : = {A, T, C, G}, that admits the form:
ATCG
−vvw A TCG
T vA − wC vG C vA wT − vG G wA vT vC −
Such a matrix S is characterized by eight parameters and reflects the assumption that the transversion rate vx depends only on the nucleotide x resulting from the transversion and not on the nucleotide that has just been substituted.
The YpR part of the model is characterized by a list r : = (rCpG, CpA, rCpG, TpG, rTpG, CpG, rTpG, TpA,
rTpA, TpG, rTpA, CpA, rCpA, TpA, rCpA, CpG)
of eight additional substitution rates describing transitions between YpR dinucleotides, as illustrated in Fig. 1. The overall substitution dynamics of the RN95 + YpR model is specified through the family R(x,y|u,v), x, y, u, v ∈ A, x=/ y, where R(x, y|u, v) describes the rate of substitution of a nucleotide x by a nucleotide y when x is surrounded by a left neighbor u and a right neighbor v. Here, the rate of substitution has the usual meaning that,
FIGURE 1.
.
 Description of transitions between YpR dinucleotides.
Downloaded from http://sysbio.oxfordjournals.org/ at MBLWHOILibrary on June 19, 2012

 512 SYSTEMATIC BIOLOGY VOL. 61
 during any infinitesimal time interval dt, a nucleotide x with a u at its left and a v at its right has a probability R(x, y|u, v)dt of being turned into a y. Given an RN95 ratematrixSandalistofYpRsubstitutionratesr,one sets
and
η(A):=A, η(G):=G, η(C):=Y=:η(T).
GivenawordW=xx...x x oflengthm ≥ 3 1 2 m−1 m
written in the nucleotidic alphabet A = {A, T, C, G}, we define the Φ-encoding of W as
Φ(W) : = ρ(x1)x2 . . . xm−1η(xm).
Now consider a nucleotide sequence X1 (t) . . . Xn (t) evolving according to an RN95 + YpR model. The following two key properties were established in Be ́rard et al. (2008).
(P1) Φ-encoded nonoverlapping polynucleotides evolve independently;
(P2) The time evolution of a Φ-encoded polynucleotide of length m forms a continuous-time Markov chain, characterized by a certain matrix of transition rates Q(S, r, m), which depends only on, and can be computed explicitly from, S, r and m.
For example, (P1) implies that the three Φ-encoded polynucleotides
Φ(X1 (t)X2 (t)X3 (t)), Φ(X4 (t)X5 (t)X6 (t)), and Φ(X7 (t)X8 (t)X9 (t)X10 (t))
evolve independently since these are nonoverlapping polynucleotides. On the other hand, (P1) cannot be applied, for example, to the pair
Φ(X2 (t)X3 (t)X4 (t)), Φ(X4 (t)X5 (t)X6 (t)),
since these are overlapping nucleotides. As an illustration of (P2), note that the time evolution of Φ(X1 (t)X2 (t)X3 (t)) corresponds to a continuous-time
R(x, y|u, v):=
s+r
x,y upx,upy
when ux and uy are YpR dinucleotides, sx,y + rxpv, ypv
when xv and yv are YpR dinucleotides, sx,y otherwise. (1)
Note that it is not possible for ux and xv to simultaneously be YpR dinucleotides since x has to be either a purine or a pyrimidine. Hence, exactly one of the three possible cases listed in (1) occurs for any given x,y,u,v.
To illustrate the above definition, consider a piece of sequence of the form ∙ ∙ ∙ ATCG ∙ ∙ ∙ . The overall substitutionrateoftheCbyaTisthenequaltowT +rCpG,TpG
since the C belongs to a CpG dinucleotide. On the other hand, the substitution rate of the C by an A is just given by vA since the YpR part of the model does not contain additional rates for transversions. For the same reasons, the substitution rate of the G by an A is wA + rCpG, CpA,
and the substitution rate of the G by a T is just vT. Now, the overall substitution rate of the T by a C is equal to wC since the T does not belong to a dinucleotide of the form YpR. As for the substitution rate of the A to a G, we would need to know the nucleotide at the left of A to determine its value.
In the sequel, we often consider restricted versions of the RN95 + YpR model in which a model more specific than RN95 is used to describe neighbor-independent substitution rates. When model M is used instead of RN95, the resulting neighbor-dependent model is denoted by M + YpR (e.g., T92 + YpR, TN93 + YpR, etc.). Also, most of the time, the only neighbor-dependent YpR substitutions we consider are CpG→TpG and CpG→CpA, with the same rate for both to ensure strand symmetry. The resulting model is then denoted M + CpGs (e.g., T92 + CpGs, TN93 + CpGs), where the “s” is for strand symmetry. Similarly, when we consider general strand-symmetric YpR substitutions, the resulting model is denoted by M + YpRs.
Note that RN95 + YpR models are in general nonreversible, even when the RN95 rate matrix describing neighbor-independent substitutions is itself reversible (see online Supplementary Material available from http://datadryad.org, doi:10.5061/dryad.5vp21b10 for details).
Φ-encoding of polynucleotides.—Let ρ denote the application, which fuses the two purines together, and η the application, which fuses the two pyrimidines together, that is,
ρ(A):=R=:ρ(G), ρ(C):=C, ρ(T):=T
Markov chain with
Supplementary Material for an explicit definition of Q(S, r, 3). Note that neither (P1) nor (P2) holds for a general neighbor-dependent substitution process. These properties are a specific feature of RN95 + YpR models, allowing for the development of the specific inference approach described in the next section.
Position of RN95 + YpR models.—Several classical neighbor-independent models fall in the RN95 class. The simplest one is the Jukes and Cantor model (Jukes and Cantor 1969), denoted JC69, where all substitution rates are equal. Then, Kimura’s K80 model (Kimura 1980) has a single parameter, which accounts for the ratio between transition and transversion rates, whereas in Felsenstein’s F81 model (Felsenstein 1981), three parameters reflect the stationary distribution of the nucleotides. Both sets of parameters are used in the models described in Felsenstein (1984) and Hasegawa et al. (1985), denoted HKY85. A special case of the HKY85 model is the T92 model, described in Tamura (1992),
rate matrix Q(S, r, 3). See online
Downloaded from http://sysbio.oxfordjournals.org/ at MBLWHOILibrary on June 19, 2012

 2012 BE ́RARDANDGUE ́GUEN—RN95+YpRMODELSINAPHYLOGENETICCONTEXT 513
 which explicitly accounts for the GC versus AT equilibrium frequencies. The TN93 model, described in Tamura and Nei (1993), is a generalization of the HKY85 model with two distinct transition rates. So far, all the models that have been described are reversible, and, in fact, TN93 is the most general reversible model falling in the RN95 class. Thus, the RN95 class does not cover all the GTR model class (Lanave et al. 1984) and not all the RN95 models are reversible either. Besides reversibility, DNA strand symmetry is an important assumption. As is the case for reversibility, the RN95 class does not cover all the general strand-symmetric model (which we call the L95 model after Lobry 1995), and, conversely, not every RN95 model is strand symmetric. The most general strand-symmetric model falling in the RN95 class comprises three parameters, and we denote it RN95s.
Neighbor dependence is introduced in our model through additional transition rates within YpR dinucleotides. From a modeling perspective, this corresponds to a rather parsimonious choice, obtained by applying a simple perturbation scheme to an existing site-independent model. This kind of approach is also found in Pedersen and Jensen (2001), Arndt et al. (2003), Arndt and Hwa (2005), Duret and Arndt (2008), Peifer et al. (2008), and Hobolth (2008). On the other hand, more complex models have been considered, in which the substitution rate at a site is allowed to fully depend upon its left and right neighbors. This kind of approach is found, for example, in Lunter and Hein (2004), Hwang and Green (2004), Siepel and Haussler (2004), Christensen et al. (2005), Christensen (2006), and Baele et al. (2008, 2010a, 2010b) and leads to parameter-rich models (e.g., the general non-reversible context-dependent model considered in Baele et al. 2010b has 192 substitution parameters). Broadly speaking, more complex models are better able to reflect elaborate features of actual biological substitution processes. However, a more parsimonious model may be desirable when one is interested in accurate parameter estimation on relatively short sequences.
Inference Based of Φ-Encodings for RN95 + YpR Models
The core idea of our approach to inference is the following. Consider a division of the sequence of interest into short nonoverlapping polynucleotides of given length. Then, according to (P1) and (P2), the Φencodings of these polynucleotides can be treated rigorously as independently evolving ”sites,” using the methods already developed for site-independent substitution models. Specifically, we use a division into nonoverlapping trinucleotides. For convenience, assume that the length n of the sequence is a multiple of 3, that is, n = 3q. Then, let
Yk0(t):=Φ(X3k−2(t)X3k−1(t)X3k(t)); k=1,...,q. Properties (P1) and (P2) allow us to treat Y10 (t), . . . , Yq0 (t)
as a sequence of independently evolving ”sites,” with
each Yk0 (t) belonging to the alphabet
A :={C,T,R}×{A,T,C,G}×{A,G,Y},
and evolving according to the substitution process on A3 specified by the rate matrix Q(S, r, 3).
Using a maximum likelihood approach, we can thus infer the parameters of the underlying RN95 + YpR model (S and r), as well as the branch lengths and topology of the phylogenetic tree, in very much the same way as for models assuming independence between sites. On the practical side, it is possible to recycle existing inference algorithms by having them use the alphabet A3 instead of A and the matrix Q(S,r,3) instead of a usual 4 × 4 rate matrix. The alphabet size is then |A3| = 3 × 4 × 3 = 36 instead of just |A| = 4, hence an additional but manageable computational cost. On the theoretical side, this approach automatically inherits the properties of maximum likelihood inference based on sequences of independent and identically distributed observations, such as asymptotic consistency and efficiency (see, e.g., van der Vaart 1998).
3
Averaged log-likelihood.—Due to the use of Φ-encodings 0
in the definition of the sequence Yk(t), the approach described above ignores a substantial part of the information contained in the sequence alignment data: No distinction is made between As and Gs at sites i = 3k − 2, nor between Cs and Ts at sites i = 3k. To improve upon this approach, we take into account not only one but all three reading frames associated with the division of the sequence into trinucleotides. More precisely, extend the definition of Yk0 (t) by letting, for l = 1, 2,
Ykl(t) : = Φ(X3k−2+l(t)X3k−1+l(t)X3k+l(t)).
Each l = 0, 1, 2 gives rise to a log-likelihood of the ob-
served data given the model, lLl, and we define the averaged log-likelihood as
lL(S,r):=13 lL0(S,r)+lL1(S,r)+lL2(S,r) . (2) The approach we adopt throughout the paper is to per-
form maximum likelihood inference with respect to the
averaged log-likelihood lL(S, r).
One practical advantage of this approach is that it
can still be carried out by recycling algorithms originally devised for models that assume independence between sites, even though overlapping Φ-encoded trinucleotides generally do not evolve independently under an RN95 + YpR model. More specifically, maximum like-
lihood inference with respect to L(S, r) can be achieved by applying a maximum likelihood algorithm that treats the whole family of Φ-encoded trinucleotides
Y kl ( t ) , l = 0 , 1 , 2 ; 1 ≤ k ≤ q
as independently evolving sites governed by the rate matrix Q(S, r, 3) (see online Supplementary Material).
 Downloaded from http://sysbio.oxfordjournals.org/ at MBLWHOILibrary on June 19, 2012

 514 SYSTEMATIC BIOLOGY VOL. 61
 From a theoretical point of view, maximum-likelihood
inference with respect to L(S, r) shares some similarities with pseudolikelihood inference (see, e.g., Christensen et al. 2005; Christensen 2006 for an illustration of this approach in the context of neighbor-dependent substi-
tution models) since L(S, r) is obtained by summing the
individual log-likelihood values computed for each Φ-
nonoverlapping Φ-encoded trinucleotides as independently evolving “sites,” this distribution must be such that nonoverlapping Φ-encoded trinucleotides are indeed independent. This property is not true in general; for example, it rules out models for the root sequence distribution based on Markov chains (see, e.g., Hwang and Green 2004; Baele et al. 2010a). A typical case where it holds is the stationary distribution of an RN95 + YpR model (that may be distinct from the one used to describe the subsequent evolution along the tree). In this paper, we consider two different options to deal with the root sequence distribution. The first one, denoted Fstat, consists in using the stationary distribution of the RN95 + YpR model describing the substitution process along the tree. The second one, denoted Fest, consists in including the root distribution of Φ-encoded trinucleotides as an additional set of parameters to be estimated in the overall likelihood maximization procedure. Clearly, Fstat is best suited to situations where the root is assumed to be at stationarity, whereas Fest can be used in general nonstationary situations.
Extension to longer polynucleotides. —So far, we have discussed our approach in the case where a division of the sequence into trinucleotides is used. A division into longer polynucleotides can also be considered; the size of the corresponding alphabet is then equal to N : = 3 × 4m−2 ×3, where m is the polynucleotide length. The main obstruction to using values of m much larger than 3 is that the computational cost of our method quickly becomes prohibiting. For instance, computing the spectral decomposition of the rate matrix has a cost of order N4, which is about 1011 with as small a value as m = 5 (see, e.g., de Koning et al. 2010 for a general discussion of computational cost associated with phylogenetic likelihood calculations).
DATA
Simulated Data Set
Simulated data provide a framework in which there is a well-defined and known stochastic substitution model governing the evolution of sequences, so that estimates can be directly compared with the true value. Our simulations mimic an alignment of Human, Chimpanzee, and Macaque sequences. The tree used in our simulations is depicted in Fig. 2, and evolution along the branches of this tree is governed by the T92 + CpGs model. This model comprises three parameters: κ is the ratio between the transition and transversion rates, θ is the equilibrium G + C frequency of the T92 model alone,
symmetric CpG neighbor-dependent transition rate and the independent transition rate from C to T. The distribution at the root is the stationary distribution of a T92 + CpGs model with ρ = ρ2 , whereas the subsequent evolution along the tree uses a T92 + CpGs model with ρ = ρ1 ,
encoded trinucleotide Yl(t) (up to the factor 1/3, which k
is irrelevant as far as maximization is concerned). However, one major difference is that, for a given phase
l, Ll(S,r) is the exact value of the log-likelihood associated with the family of Φ-encoded trinucleotides Ykl(t), 1 ≤ k ≤ q , so that it is only the dependence between distinct phases, not within them, which makes L(S, r) distinct from the exact value of the log-likelihood
of the whole alignment.
A theoretical justification.—Let us now sketch a the-
oretical justification for the use of L(S,r), based on asymptotic theory. Denote by n the number of nonoverlapping trinucleotides in the alignment used for the inference. Under generic assumptions, standard asymptotic theory for independent identically distributed sequences (see, e.g., van der Vaart 1998) yields that, for
each l = 0, 1, 2, as n goes to infinity, n−1Ll(S, r) converges to the expected log-likelihood E(S0 ,r0 ) (L(S, r)) of a Φ-encoded trinucleotide, where (S0 , r0 ) denotes the true value of the parameters in the model. As a consequence, n−1 Ll (S, r) also converges to E(S0 ,r0 ) (L(S, r)), and this guarantees the asymptotic consistency of our approach (i.e., the fact that estimated value of the parameters do indeed converge to their true value when the length of the alignment goes to infinity). Moreover, using translation invariance and mixing properties of the model in a similar way as Falconnet (2010), we can prove that the limiting distribution of the vector n−1/2 Ll (S, r) − E(S0 ,r0 ) (L(S, r)) l=0,1,2 is that of a tridi-
mensional centered normal vector Z=(Z0, Z1, Z2) whose covariance matrix is of the form
vcc cov(Z)= c v c .
ccv
As a consequence, the definition of the averaged log-
likelihood L through (2) provides (in the sense of asymptotically unbiased with minimum variance) the optimal way of combining the three log-likelihood
values Ll (S, r),
l = 0, 1, 2 to produce an estimate of
E
(S0 ,r0 )
(L(S, r)).
and ρ = rCpG, CpA = rCpG, TpG is the ratio between the sC,T sC,T
  Dealing with the root distribution.—Since RN95 + YpR models are nonreversible, the probability distribution of the sequence at the root plays a role in the inference, and the likelihood of the observed alignment of sequences has to be averaged with respect to this distribution. To comply with our approach that treats
Downloaded from http://sysbio.oxfordjournals.org/ at MBLWHOILibrary on June 19, 2012

 2012 BE ́RARDANDGUE ́GUEN—RN95+YpRMODELSINAPHYLOGENETICCONTEXT 515
    FIGURE 2. Tree used for the simulation of the human– chimpanzee–macaque alignment data set SIM DAT.
the values κ = 3 and θ = 0.4 being fixed throughout. In the sequel, we use the name Sim Dat to refer to artificial data simulated according to this scheme.
Note that we deliberately chose to run simulations on a shallow tree with few leaves so as to produce a data set in which the sequences carry very little information about the substitution process. We think of the resulting data set as a worst-case scenario for parameter estimation, compared with real situations.
Primate DNA Data Set
We applied our method on a data set consisting of a human genome sequence aligned with genomes from nine other primate species (Chimpanzee, Gorilla, Orangutan, Macaque, Baboon, Marmoset, Tarsier, Gray mouse lemur, and Galago), see Fig. 3. Specifically, we retrieved the sequence of the ENm001 region of the ENCODE Pilot Project (Consortium 2007) (position 115,810,521 to position 117,687,946 on chromosome 7) from the hg19 version of the human genome, together with aligned primate sequences, as available from the Galaxy web tool (http://galaxy.psu.edu/). This alignment is denoted ENm001 in the sequel.
Among the 1,877,425 bases in the human sequence of ENm001, 810,623 belong to repeated elements, according to the RepeatMasker (Smit et al. 1996) annotations on the human sequence from the University of California–Santa Cruz Table Browser (http://genome. ucsc.edu/cgi-bin/hgTables). The corresponding portion of ENm001 was extracted, and, to obtain a data set similar to the ”Ancestral Repeats” data set (Baele et al. 2008), pieces of the alignment corresponding to simple repeats, low complexity regions, members of the Alu family, and RNA elements that diverged less than 25% and L1
FIGURE 3. Tree topology of the primate species included in the alignment.
elements that diverged less than 20% from the reference RepBase sequence, were removed. The resulting alignment is 460,402 sites long (428,042 bp in the human sequence) and is denoted ENm001 AR in the sequel.
Finally, Enm001 sw denotes a division of Enm001 into nonoverlapping sliding windows of length 2000 bases.
RESULTS
Assessment on Simulated Data
Accuracy of parameter estimation.—To assess the accuracy of the estimates of the CpG hypermutability rate delivered by our method, we performed tests on the simulated data set Sim Dat. The value of the hypermutability parameters was fixed to ρ = ρ1 = ρ2 = 10. Figure 4 shows the results of the inference of the hypermutability rate ρ produced by maximum average likelihood with T92 + CpGs + Fstat, for a sequence length varying from 1000 to 20,000 bases (each estimation was repeated 100 times). As expected from the theoretical considerations presented in the Materials and Methods section, the results do not show any substantial bias. Moreover, the estimation is reasonably accurate for sequences as short as 2000 bases long.
Let us point out that, since the depth of the tree is only 0.029 substitution per site, a sequence of length 2000 has accumulated on average 58 substitutions from the root sequence. Moreover, since the root sequence is at the equilibrium of the T92 + CpGs model with a rather large (ρ = 10) CpG hypermutability ratio, only a tiny fraction of these substitutions consists of CpG substitutions. As a result, the data contain few hints of CpG hypermutability, and one expects the estimation of ρ to be difficult. Estimations on the same data with T92 + CpGs + Fest instead of T92 + CpGs + Fstat yield similar results, although with a larger variance, as expected due to the larger number of parameters to be estimated (see online Fig. 1).
Comparison against alternative methods.—We performed comparisons between the estimates of the CpG hypermutability rate delivered by several methods, using the simulated data set Sim Dat, with sequences of length 10,000. The value of the hypermutability parameters was fixed to ρ = ρ1 = ρ2 = 10. Each estimation was repeated 100 times. The results are shown on Fig. 5. The
FIGURE 4. Estimation of ρ=10 with T92 +CpGs +Fstat.
      Downloaded from http://sysbio.oxfordjournals.org/ at MBLWHOILibrary on June 19, 2012

 516 SYSTEMATIC BIOLOGY
name DA08 refers to the method developed in Duret and Arndt (2008), which is based on MCMC data augmentation. The name BVV10 refers to the method developed in Baele et al. (2008) and improved in Baele et al. (2010a), also based on MCMC data augmentation. Finally, H08 refers to the method developed in Hobolth (2008), where the special form of the model allows for a direct maximum likelihood estimation with respect to the stationary distribution. Note that a value of ρ cannot always be straightforwardly calculated from the estimated model parameters produced by the various methods. The details are given in the online Appendix.
The computer program corresponding to the DA08 method uses the general single-site strand-symmetric model (L95) plus strand-symmetric CpG effect. Note that the T92 + CpGs model is included in the L95 + CpGs class, so that our simulated data set Sim Dat is indeed a legitimate test case for the DA08 method. Since the L95 class is not included in RN95, it is not possible to perform a comparison between DA08 and our maximum average likelihood method under exactly the same set of assumptions on the underlying substitution model. To ensure fairness, we chose to work with a subclass of RN95 containing T92 and admitting the same number of parameters (six) as L95, namely the TN93 class. Moreover, since the root distribution is not prescribed in DA08, we performed estimations with the TN93 + CpGs + Fest method instead of TN93 + CpGs + Fstat. As regards the BVV10 method, the substitution model consists in 16 distinct GTR models describing the rate matrix at a site given the 16 possible combinations of nucleotides at its left and right neighbors. Due to its lack of reversibility (even when the flanking bases are fixed, see online Supplementary Material), the T92 + CpGs model used to produce the data set does not fit into this framework. The model underlying the H08 postulates a special form for CpG hypermutability in which T92 + CpGs does not meet either.
With these precisions kept in mind, one sees that our approaches provide the most accurate estimates. The DA08 method does not show substantial bias but achieves a much larger variance than TN93 + CpGs + Fest. Finally, the BVV10 and H08 methods deliver estimates with low variance but sizeable bias, reflecting the inadequacy between the model used to produce the simulations and the one assumed in the inference method.
Estimation of a recently modified CpG hypermutability rate.—We assessed the accuracy of the estimation of the CpG hypermutability rate on the simulated data set Sim Dat with two distinct rates ρ1 and ρ2 and sequences 5000 bases long. One may think of this data set as representing a piece of DNA having evolved for an infinitely long time prior to the root in a methylated background—associated with a large value for ρ2, and then, starting from the root, evolving in a hypomethylated environment—associated with a low value for ρ1 or the other way around. The results obtained by maximum averaged likelihood estimation with T92 + CpGs +
VOL. 61
  FIGURE 5. 10,000 bases long.
Estimation of ρ = 10 by several methods. Sequences are
Fest are shown on Fig. 6 (each estimation was repeated 100 times). One can see that the value of ρ1 is accurately estimated over a wide range of values of ρ2.
One of the ideas developed in this paper is that an estimation of the CpG hypermutability rate based on aligned sequence data may lead to a more reliable detection of a hypomethylated environment than the traditional CpGo/e-based criteria (see below). To illustrate this point, we computed the value of the CpGo/e ratio in the artificial ”human” sequences simulated in Sim Dat. The results are shown on Fig. 6 (each estimation was repeated 100 times). One can see that the value of CpGo/e is quite sensitive to the value of ρ2, as opposed to our estimation of ρ1.
Results on the Primate DNA Data Set
Comparison of models within the RN95 + YpR class.—Using the averaged log-likelihood computed on Φ-encodings, we performed a series of goodness-of-fit comparisons on the ENm001 and ENm001 AR alignment data sets, for a variety of neighbor-dependent substitution models. Since the validity of the approach based on Φencodings is limited to the RN95 + YpR class, the only comparisons allowed are between models that belong to this class. Still, within this limited framework, we can assess the impact of including/neglecting neighbor dependence in the substitution model and of a variety of assumptions about the neighbor-independent part of the model.
We considered seven neighbor-independent models (JC69, K80, T92, HKY85, TN93, RN95s, and RN95), in combination with no (denoted +0), strand-symmetric CpG only (denoted +CpGs), and general strandsymmetric YpR (denoted +YpRs), neighbor-dependent substitution rates. For each of the resulting models, maximum likelihood estimation was performed. Even for neighbor-independent (i.e., +0) models, the likelihood was computed using Φ-encoded trinucleotides, so as to make comparisons possible. Table 1 shows the resulting log-likelihood values, together with the estimation of the CpG hypermutability rate.
Several conclusions are consistently supported by both data sets. First, it appears that the two most important factors affecting goodness-of-fit are the inclusion of CpG neighbor dependency and the consideration of distinct transition and transversion rates.
    Downloaded from http://sysbio.oxfordjournals.org/ at MBLWHOILibrary on June 19, 2012

 2012 BE ́RARDANDGUE ́GUEN—RN95+YpRMODELSINAPHYLOGENETICCONTEXT 517
  FIGURE 6. Simulations of 5000 bases long sequences for several values of ρ1 and ρ2 along the tree depicted in Fig. 2. Left: Estimation of ρ1 with the T92 + CpGs + Fest method. Right: CpGo/e.
Indeed, a model as simple as K80 + CpGs leads to a better fit than all other models with no neighbor dependency. On the other hand, JC69 + CpGs is inferior to the more complicated +0 models, even though it outperforms K80 + 0. Moreover, we note that the improvement of the fit obtained by using +YpRs instead of +CpGs is
TA B L E 1. Gain of maximum log-likelihoods for ENm001 and ENm001 AR data sets, compared with JC69 + 0 model, and estimation of the CpG hypermutability rate, with various reconstruction models (np: number of free parameters)
much smaller than the one resulting from using +CpGs instead of +0.
We also see that, for the neighbor-independent part of the model, the assumption of reversibility gets less support than strand symmetry, even when nonreversible YpR neighbor-dependent substitutions are included. Indeed, TN93 is the most general reversible model in the RN95 class (with five parameters) but always does worse than RN95s (with only three parameters). The quality of the fit of TN93 is greatly improved when one includes CpG or more generally YpR neighbor dependency, but even then the model gets less support than RN95s.
Finally, we observe that the RN95s and RN95 models yield quite comparable results in terms of goodnessof-fit and estimation of the hypermutability rate, even though the RN95s model has only three free parameters. Note that these results are consistent with those of Siepel and Haussler (2004) and Baele et al. (2010b) and confirm the relevance of the strand symmetry assumption.
As regards the estimation of the hypermutability rate ρ, our method produces values that are of the same order of magnitude as those obtained in previous studies, except for the JC69 model. In Arndt et al. (2003), on human intergenic DNA, Arndt and collaborators estimated the neighbor-dependent CpG→TpG substitution rate to be 9.51 times the neighbor-independent nucleotide C→T substitution rate. In Arndt and Hwa (2005), on human AluSx SINEs, this ratio was estimated to be 10.45. In Lunter and Hein (2004), the estimated
     Model
JC69 + CpGs JC69 + YpRs K80 + 0
K80 + CpGs K80 + YpRs T92 + 0
T92 + CpGs T92 + YpRs HKY85 + 0 HKY85 + CpGs HKY85 + YpRs TN93 + 0
TN93 + CpGs TN93 + YpRs RN95s + 0 RN95s + CpGs RN95s + YpRs RN95 + 0 RN95 + CpGs RN95 + YpRs
ENm001 AR np Log-likelihood
ENm001 ρ Log-likelihood
ρ
25.078 38.855
12.719 14.521
9.916 10.283
9.916 10.284
9.917 10.284
9.242 9.158
9.242 9.158
 1 31,384.1 4 40,812.0 1 28,161.6 2 54,588.2 5 54,848.2 2 37,678.4 3 55,882.1 6 56,076.7 4 37,701.8 5 55,905.0 8 56,100.2 5 37,707.8 6 55,913.0 9 56,106.0 3 38,661.3 4 56,416.9 7 56,754.1 7 38,690.2 8 56,447.4
11 56,782.8
30.242 132,534.1 48.381 173,423.1 118,040.5 15.774 226,295.3 17.548 228,052.1 164,839.6 12.915 234,796.9 13.286 236,027.8 164,874.3 12.915 234,829.6 13.288 236,062.2 164,901.1 12.916 234,861.6 13.287 236,088.8 169,535.9 12.094 237,311.3 11.978 239,298.5 169,596.7 12.095 237,375.7 11.979 239,358.8
 Downloaded from http://sysbio.oxfordjournals.org/ at MBLWHOILibrary on June 19, 2012

 518 SYSTEMATIC BIOLOGY VOL. 61
 value is 14.1 for human chromosome 21 and 7.6 for human chromosome 10.
We note that the estimated values of ρ obtained for the ENm001 and ENm001 AR data sets are comparable, although consistently larger on repeated elements (data set ENm001 AR). as expected from the results of Meunier et al. (2005) and Meissner et al. (2008). Also, the estimated values tend to be larger when the neighbor-independent part of the model is assumed to be reversible. Finally, RN95s and the more general RN95 produce exactly the same estimates.
In view of the above results, we chose to work with the RN95s model for the subsequent analysis of the ENm001 data set.
Impact on phylogenetic reconstruction.—We assessed the impact of taking into account neighbor dependence on the estimation of phylogenetic tree branch lengths. Specifically, we compared the results obtained with the RN95s + CpGs and RN95s + 0 models on each window of the Enm001 sw data set for the estimation of the ratio li/l0, where li denotes the length between the leaf corresponding to the human sequence and node i in Fig. 3. As a result, the estimates are on average equal on short distances (less than 0.05 substitution per site), but on
longer distances, the estimates obtained with RN95s + 0 are smaller than those obtained with RN95s + CpGs. For instance, between node 0 and node 5, the average distance estimated with model RN95s + CpGs is 0.0963, and the ratio is 1.09 higher on average than with RN95s + 0 (see Fig. 2 in the online Appendix).
Variation of CpG Hypermutability
Estimating CpG hypermutability along the sequence.—We applied our inference method to the primate DNA data set, using maximum averaged likelihood with the RN95s + CpGs model combined with Fest. Since the results obtained on the simulated data set SIM DAT suggest that our method is accurate enough to probe the variability of the CpG hypermutability rate ρ at a scale of a few kilobases, we computed estimates of ρ for each of the sliding windows contained in ENm001 sw. The resulting map of CpG hypermutability is shown on the top of Fig. 7. One sees that our estimates of ρ lie most often between 7 and 16, with occasional peaks well below or above these values.
Observed and stationary CpGo/e.—Our method delivers an estimate of hypermutability based on the inferred value of the hypermutability rate on an alignment of
      FIGURE 7. Prediction of hypomethylated islands in ENm001. Top: Estimation of ρ on sliding windows of length 2000. The gray line is the 2.25 threshold to discriminate hypomethylated islands, and the dots beneath locate the hypomethylated islands predicted with this criterion. Middle: The RefSeq genes and the CpG islands predicted by other methods. Bottom: CpGo/e of the human sequence under study, on the same windows.
Downloaded from http://sysbio.oxfordjournals.org/ at MBLWHOILibrary on June 19, 2012

 2012 BE ́RARDANDGUE ́GUEN—RN95+YpRMODELSINAPHYLOGENETICCONTEXT 519
 sequences. A more usual measure of CpG hypermutability is the CpGo/e ratio, defined as the ratio between the observed frequency of CpG dinucleotides and the frequency we would expect if nucleotides at distinct sites were stochastically independent,
frequency of CpG CpGo/e = frequency of C × frequency of G .
In the long run, CpG hypermutability leads to a depletion of the number of CpG dinucleotides, relative to the abundance that would be observed in the absence of neighbor-dependent effects. As a consequence, large values of the hypermutability rate are expected to correspond to low values of CpGo/e, and, conversely, low values of the hypermutability rate are expected to correspond to values of CpGo/e close to one. Such a correspondence relies on the long-term effect of CpG hypermutability and may be somewhat imperfectly verified in situations where the substitution process has not be given enough time to substantially alter the sequence composition. For example, one may imagine a transposable element recently inserted in a background whose methylation characteristics differ from those in which it had previously evolved. The simulations shown in Fig. 6 provide an artificial example of this phenomenon.
To illustrate this point on the primate DNA data set, we compare the value of the actually observed CpGo/e ratio with the long-term stationary value CpGo/e* predicted from our estimate of the hypermutability rate (the formula for CpGo/e* is given in the online Supplementary Material), for each of the sliding windows of length 2000 of the ENm001 sw alignment. The results are shown on Fig. 8. Each point corresponds to a pair (CpGo/e, CpGo/e*) for one of the sliding windows of ENm001 sw. While there is broad agreement between the two statistics, substantial differences are observed for windows whose (CpGo/e,CpGo/e*) lies
FIGURE 8. Relation between the observed CpGo/e values and the CpGo/e at stationarity (CpGo/e*). The points correspond to the estimated values of CpGo/e and CpGo/e* on the windows of ENm001 sw. The gray line represents the line CpGo/e = CpGo/e*.
around (0.4, 0.25). We interpret this discrepancy as a sign that, for these windows, the effect of the CpG hypermutability rate is not yet fully reflected in the base composition.
Note that the distribution of CpGo/e* shows a clear division between a large cluster of values around CpGo/e* = 0.2 and a more scattered set of values lying above CpGo/e* = 0.4. The same division is observed on the distribution of CpGo/e, but the distinction between the two groups of values is less well-marked.
Hypomethylated islands.—In some stretches of DNA, CpG dinucleotides are less methylated. These are often associated with promoter regions (Ponger et al. 2001) and are typically 300–3000 bases long. We call such stretches hypomethylated islands in the sequel. In the human genome, the average CpGo/e is about 0.25 (as we have seen also in Fig. 8), but it is higher in some of these stretches called CpG-islands. Basically (GardinerGarden and Frommer 1987), CpG-islands are characterized as segments at least 200 bases long, with a G + C proportion at least 0.5 and CpGo/e  0.6.
To our knowledge, no method aimed at detecting hypomethylated islands exploits the information contained in an alignment. Instead, all the methods we know rely solely on the composition of the sequence of interest. Some are based on the CpGo/e (GardinerGarden and Frommer 1987; Ponger and Mouchiroud 2001), others on the CpG density (Hackenberg et al. 2006), or on a Hidden Markov Model for the sequence (Durbin et al. 1998; Wu et al. 2010). The approach we develop consists in using the estimation of the hypermutability rate ρ inferred from an aligned set of sequences, to locate hypomethylated islands.
As explained earlier, statistics based exclusively on the composition of the sequence may be misleading indicators of the current methylation level. In order to prevent the detection of false positives, methods that look for CpG-islands are most often used on data from which recently inserted elements have been masked (with the exception of Wu et al. 2010). On the other hand, our method exploits phylogenetic information about the sequence of interest and should be less affected by this kind of problem. In fact, the estimates of the hypermutability rate presented in this section were all obtained from nonmasked data.
To single out hypomethylated islands, a precise limit on the value of ρ has to be fixed. We based our approach on estimations of ρ on alignments around the Transcription Start Sites of the human genome, leading to a threshold value of 2.25. The details of the method are given in the online Appendix.
We see in Fig. 7 that our predictions of hypomethylated islands match perfectly with the CpG-islands found by other methods, with the exception of the results of Wu et al. (2010). Note that the additional CpGislands found by Wu et al. (2010) all lie inside recently inserted repeated elements (less than 8.5% divergence from the reference sequence).
     Downloaded from http://sysbio.oxfordjournals.org/ at MBLWHOILibrary on June 19, 2012

 520
SYSTEMATIC BIOLOGY VOL. 61
 DISCUSSION
analysis of CpG-hypermutability in the whole human genome. However, our method does not yield a precise localization of the boundaries of hypomethylated islands, and it would be interesting to combine it with more elaborate segmentation methods, using, for example, hidden Markov models. Another perspective is to use branch-dependent hypermutability rates to look for the evolution of methylation in hypomethylated islands.
Finally, following Pedersen et al. (1998) and Christensen et al. (2005), it would be interesting to extend our approach to codon evolution models, to study the effect of CpG hypermutability on the estimation of selection. Such an extension should take care of the fact that Φ-encoding of codons is not fully compatible with the genetic code.
SUPPLEMENTARY MATERIAL
Supplementary material, including data files and/or online-only appendices, can be found in the Dryad data repository (DOI:10.5061/dryad.5vp21b10).
ACKNOWLEDGMENTS
We thank Laurent Duret and Manolo Gouy for their useful help, as well as the associate editor and three anonymous reviewers for their very constructive suggestions. Our method has been implemented in the Bio++ suite (Dutheil et al. 2006). The sources are available at the address http://biopp.univ-montp2.fr/. The maximum likelihood program is called bppml, which sources, and standalone executables are available at the address http://home.gna.org/bppsuite. Usage files are also available on this site. All alignment simulations have been performed with the Python suite alfacinha available at the address http://pbil.univlyon1.fr/software/alfacinha/.
For the RN95 + YpR class of neighbor-dependent nucleotide substitution models, we have described a method that maps the substitution process affecting a sequence onto a process in which sites evolve independently. This allows the usual inference algorithms to be exploited without introducing additional approximations. Likelihood computations using Felsenstein’s recursion algorithm (Felsenstein 2004) with our model are roughly 81 times slower than with the usual neighborindependent DNA substitution models since we have to use an alphabet that is 9 times larger. This makes our method practical for the study of large data sets.
Using a simulated data set mimicking aligned human–chimpanzee–macaque sequences, we have shown that the CpG-hypermutability rate is accurately estimated even on alignments containing little information on the substitution process (few sequences, shallow trees, and sequences as short as 2000 bases long). Extending the method to polynucleotides of length larger than three may further improve the accuracy, although it would substantially increase the computational requirements.
On a primate DNA alignment comprising sequences from 10 species, we performed goodness-of-fit comparisons between models within the RN95+ YpR class. We found that the two most important factors affecting goodness-of-fit are the inclusion of CpG neighbor dependency and the consideration of distinct transition and transversion rates. Also, for the neighborindependent part of the model, the reversibility assumption is less supported than strand symmetry. Following Yang (1994), an interesting perspective would be to incorporate rate variability in the model, taking care of the fact that the rate of evolution of a Φ-encoded trinucleotide depends on the respective rates of evolution of the three corresponding nucleotides.
We also performed comparisons of estimated branch lengths on the primate DNA alignment. Taking into account, CpG hypermutability in the substitution model leads to no effect on short branches but to a noticeable though not major effect on branches as long as 0.1 substitution per site. It would be interesting to study this phenomenon on trees with longer branches, such as the whole mammal family tree, where more substitutions due to the CpG influence are expected.
On the primate DNA data set, we computed estimates of the CpG hypermutability rate. The overall rate is found to be approximately 9.2. Thanks to the accuracy of the method, we were able to probe the variability of this rate at a scale of a few kilobases. This leads to a new approach to the detection of hypomethylated islands, based on the comparison of the estimated hypermutability rate with a threshold value. Unlike other methods that rely solely on the composition of the sequence under study, our method takes advantage of the available phylogenetic information. The results suggest that this method has the ability to accurately detect hypomethylated islands and can lead to a more thorough
Downloaded from http://sysbio.oxfordjournals.org/ at MBLWHOILibrary on June 19, 2012
